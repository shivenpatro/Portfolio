"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[379],{3379:(e,t,i)=>{i.r(t),i.d(t,{default:()=>o});var s=i(6482),r=i(2682),n=i(8727),a=i(4571);class h{setupEventListeners(){let e=()=>{this.resize()};window.addEventListener("resize",e),this.cleanupListeners=()=>{window.removeEventListener("resize",e)}}resize(){let e,t;this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.renderer.setSize(this.width,this.height),this.height/this.width>this.imageAspect?(e=this.width/this.height*this.imageAspect,t=1):(e=1,t=this.height/this.width/this.imageAspect),this.material&&(this.material.uniforms.resolution.value.x=this.width,this.material.uniforms.resolution.value.y=this.height,this.material.uniforms.resolution.value.z=e,this.material.uniforms.resolution.value.w=t),this.camera.updateProjectionMatrix(),this.regenerateGrid()}regenerateGrid(){this.size=this.settings.grid;let e=this.size,t=this.size,i=e*t,s=new Float32Array(4*i);for(let e=0;e<i;e++){let t=255*Math.random()-125,i=255*Math.random()-125,r=4*e;s[r]=t,s[r+1]=i,s[r+2]=t,s[r+3]=255}this.texture=new n.GYF(s,e,t,n.GWd,n.RQf),this.texture.magFilter=this.texture.minFilter=n.hxR,this.material&&(this.material.uniforms.uDataTexture.value=this.texture,this.material.uniforms.uDataTexture.value.needsUpdate=!0)}addObjects(){this.regenerateGrid();let e=new n.gPd(this.img);e.needsUpdate=!0,e.wrapS=e.wrapT=n.ghU,e.minFilter=e.magFilter=n.k6q,e.flipY=!1,this.material=new n.BKk({side:n.$EB,uniforms:{time:{value:0},resolution:{value:new n.IUQ},uTexture:{value:e},uDataTexture:{value:this.texture}},vertexShader:"\nprecision mediump float;\nuniform float time;\nvarying vec2 vUv;\nvarying vec3 vPosition;\nvoid main() {\n  vUv = uv;\n  vPosition = position;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"\nprecision mediump float;\nuniform float time;\nuniform sampler2D uDataTexture;\nuniform sampler2D uTexture;\nuniform vec4 resolution;\nvarying vec2 vUv;\nvarying vec3 vPosition;\nvoid main() {\n	vec2 newUV = (vUv - vec2(0.5)) * resolution.zw + vec2(0.5);\n	vec4 offset = texture2D(uDataTexture, vUv);\n	\n	// Apply displacement based on offset\n	vec2 displacedUV = newUV - 0.02 * offset.rg;\n	vec4 color = texture2D(uTexture, displacedUV);\n	\n	gl_FragColor = color;\n}\n",transparent:!0}),this.plane=new n.eaF(this.geometry,this.material),this.scene.add(this.plane)}updateDataTexture(){if(!this.texture)return;let e=this.texture.image.data;for(let t=0;t<e.length;t+=4)e[t]*=this.settings.relaxation,e[t+1]*=this.settings.relaxation;let t=.1*this.time,i=this.size*(.5+.5*Math.cos(t)),s=this.size*(.5+.5*Math.sin(2.1*t)),r=.1*this.size,n=this.height/this.width;for(let a=0;a<this.size;a++)for(let h=0;h<this.size;h++){let o=(i-a)**2/n+(s-h)**2;if(o<r**2){let i=4*(a+this.size*h),s=r/Math.sqrt(o);s=Math.max(0,Math.min(s,10)),e[i]+=100*this.settings.strength*Math.sin(3*t)*s,e[i+1]-=100*this.settings.strength*Math.cos(2.5*t)*s}}this.texture.needsUpdate=!0}destroy(){this.isPlaying=!1,this.animationId&&cancelAnimationFrame(this.animationId),this.cleanupListeners&&this.cleanupListeners(),this.renderer.domElement.parentNode&&this.renderer.domElement.parentNode.removeChild(this.renderer.domElement),this.renderer.dispose(),this.geometry.dispose(),this.material&&this.material.dispose(),this.texture&&this.texture.dispose()}constructor(e,t,i={}){if(this.material=null,this.texture=null,this.time=0,this.isPlaying=!0,this.imageAspect=1/1.5,this.animationId=null,this.cleanupListeners=null,this.render=()=>{this.isPlaying&&(this.time+=.05,this.updateDataTexture(),this.material&&(this.material.uniforms.time.value=this.time),this.animationId=requestAnimationFrame(this.render),this.renderer.render(this.scene,this.camera))},this.container=e,this.img=t,this.width=e.offsetWidth,this.height=e.offsetHeight,this.settings={grid:i.grid||34,mouse:i.mouse||.25,strength:i.strength||1,relaxation:i.relaxation||.9},this.size=this.settings.grid,this.mouse={x:0,y:0,prevX:0,prevY:0,vX:0,vY:0},this.scene=new n.Z58,this.renderer=new a.JeP({alpha:!0,antialias:!0,preserveDrawingBuffer:!1,powerPreference:"high-performance"}),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.setSize(this.width,this.height),this.renderer.setClearColor(0,0),!this.renderer.getContext()){console.error("WebGL context not available");return}this.renderer.domElement.id="pixelated-canvas",e.appendChild(this.renderer.domElement),this.camera=new n.qUd(-.5,.5,.5,-.5,-1e3,1e3),this.camera.position.set(0,0,2),this.geometry=new n.bdM(1,1,1,1),this.regenerateGrid(),this.addObjects(),this.resize(),this.setupEventListeners(),this.render()}}let o=e=>{let{src:t,alt:i="",className:n="",grid:a=34,mouse:o=.25,strength:l=1,relaxation:d=.9,style:u={}}=e,m=(0,r.useRef)(null),c=(0,r.useRef)(null),g=(0,r.useRef)(null),[v,p]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{if(v&&m.current&&c.current)return g.current=new h(m.current,c.current,{grid:a,mouse:o,strength:l,relaxation:d}),()=>{g.current&&(g.current.destroy(),g.current=null)}},[v,a,o,l,d]),(0,s.jsxs)("div",{className:"pixelated-image-container ".concat(n),style:{position:"relative",...u},children:[(0,s.jsx)("img",{ref:c,src:t,alt:i,crossOrigin:"anonymous",onLoad:()=>{p(!0)},onError:()=>{console.warn("Failed to load image, CORS issue or invalid URL")},style:{width:"100%",height:"100%",objectFit:"cover",visibility:v?"hidden":"visible"}}),(0,s.jsx)("div",{ref:m,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"}})]})}}}]);